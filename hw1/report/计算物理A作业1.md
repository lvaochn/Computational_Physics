<h1 align = 'center'>计算物理A作业1</h1>

<h3 align = 'center'>吕遨 PB19030789</h3>

## 1.作业题目

用Schrage方法编写随机数子程序，用指定间隔（非连续$l>1$）两个随机数作为点的坐标值绘出若干点的平面分布图。再用$\left <x^k\right>$测试其均匀性（取不同量级的N值，讨论偏差与$N$的关系）、$C(l)$测试其二维独立性（总点数$N>10^7$）。



## 2.算法和主要公式

（1）Lehmer线性同余随机数产生器
$$
I_{n+1}=(aI_n+b)\,mod\,m \\
x_n=I_n/m
$$
​         在本实验中我们采用16807随机数产生器，即$a=16807,b=0,m=2^{32}-1$。

（2）由于计算机不能自动取模，故在计算过程中有可能产生数据溢出的情况，为此我们设计了Schrage方法来进行取模：

​          设m可表示为
$$
m=aq+r,q=[m/a],r=m\,mod\,a
$$
​         则对$r<q$和$0<z<m-1$容易得到
$$
az\,mod\,m=
\begin{cases}
a(z\,mod\,q)-r[z/q], &if\ge0\\
a(z\,mod\,q)-r[z/q]+m,&otherwise

\end{cases}
$$
​          我们在**schrage.c**程序中实现以上结果。

（3）用指定间隔的两个随机数作为点的坐标值绘出若干点的平面分布图，我们可以直观地从图中观察随机数点的均匀性和独立性。

（4）对于$\left <x^k\right>$，从图像上看相当于在区间[0,1]内随机撒很多点，点的权重是$\left <x^k\right>$，则相应的期望应该就是$\int_0^1x^k\,\text dx=\frac{1}{k+1}$。

​          间距为$l$的自相关函数是
$$
C(l)=\frac{\left<x_nx_{n+l}\right>-\left<x_n\right>^2}{\left<x_n^2\right>-\left<x_n\right>^2}
$$

​          其中平均值的定义是
$$
\left<x_n\right>=\frac{\sum\limits_{n=1}^{N}x_n}{N}
$$
​         理想情况下，当两个随机数序列$x_n$和$x_{n+l}$不相关时，$\left<x_nx_{n+l}\right>=\left<x_n\right>\left<x_{n+l}\right>=\left<x_n^2\right>$，所以相关系数为0。

​         我们在**C_l.c**程序中实现上述功能。

## 3.计算结果及分析

### 3.1 作图观察随机数点的分布

分别取N=100,1000,10000,100000,作出随机点的平面分布图如下：

   

<img src="E:\Computational_Physics\hw1\N=100.png" alt="N=100" style="zoom:80%;" />

<img src="E:\Computational_Physics\hw1\N=1000.png" alt="N=1000" style="zoom:80%;" />

<img src="E:\Computational_Physics\hw1\N=10000.png" alt="N=10000" style="zoom:80%;" />

<img src="E:\Computational_Physics\hw1\N=100000.png" alt="N=100000" style="zoom:80%;" />

我们可以看到，当N取10000和100000量级后，可以认为点均匀铺满了整个平面，我们所采用的16807随机数产生器的效果不错。

### 3.2 用$\left<x_k\right>$测试均匀性

下面我们考虑均匀性指标$\left<x_k\right>$的误差情况，我们编程分别计算出不同点数N下$\left<x^k\right>$与其期望值$\frac{1}{k+1}$之间的误差：

N=100

```c
随机数x的1阶矩为0.518425
随机数x的2阶矩为0.354780
随机数x的3阶矩为0.269625
随机数x的4阶矩为0.217525
```

| $k$  | $\left<x^k \right>$ | $\left<x^k \right>-\frac{1}{k+1}$ |
| :--: | :-----------------: | :-------------------------------: |
|  1   |      0.518425       |             0.018425              |
|  2   |      0.354780       |             0.021447              |
|  3   |      0.269625       |             0.019625              |
|  4   |      0.217525       |             0.017525              |

N=1000

```C
随机数x的1阶矩为0.497961
随机数x的2阶矩为0.326714
随机数x的3阶矩为0.240649
随机数x的4阶矩为0.189389
```

| $k$  | $\left<x^k \right>$ | $\left<x^k \right>-\frac{1}{k+1}$ |
| :--: | :-----------------: | :-------------------------------: |
|  1   |      0.497961       |             -0.002039             |
|  2   |      0.326741       |             -0.006592             |
|  3   |      0.240649       |             -0.009351             |
|  4   |      0.189389       |             -0.010611             |

N=10000

```c
随机数x的1阶矩为0.501827
随机数x的2阶矩为0.335474
随机数x的3阶矩为0.252228
随机数x的4阶矩为0.202284
```

| $k$  | $\left<x^k \right>$ | $\left<x^k \right>-\frac{1}{k+1}$ |
| :--: | :-----------------: | :-------------------------------: |
|  1   |      0.501827       |             0.001827              |
|  2   |      0.335474       |             0.002140              |
|  3   |      0.252228       |             0.002228              |
|  4   |      0.202284       |             0.002284              |

N=100000

```c
随机数x的1阶矩为0.500284

随机数x的2阶矩为0.333479

随机数x的3阶矩为0.249986

随机数x的4阶矩为0.199877
```

| $k$  | $\left<x^k \right>$ | $\left<x^k \right>-\frac{1}{k+1}$ |
| :--: | :-----------------: | :-------------------------------: |
|  1   |      0.500284       |             0.000284              |
|  2   |      0.333479       |             0.000146              |
|  3   |      0.249986       |             0.000014              |
|  4   |      0.199877       |             0.000123              |

根据以上的计算我们可以看到，在N=100的情况下误差在$10^{-2}$量级，随着点数N的增加误差逐渐变小，在N=100000时误差量级基本在$10{-4}$，可见我们的16807随机数产生器产生的随机数均匀性还是比较好的。

### 3.3 用$C(l)$测试随机性

我们同样可以编程计算不同$l$下$C(l)$的数值，结果如下：

$N=10^7$结果

```c
C(1)=0.000344
C(2)=0.000039
C(3)=0.000360
C(4)=-0.000046
C(5)=-0.000063
C(6)=0.000510
C(7)=0.000036
C(8)=0.000230
C(9)=-0.000191
C(10)=-0.000268
C(11)=-0.000847
C(12)=0.000146
C(13)=-0.000112
C(14)=-0.000090
C(15)=0.000049
C(16)=0.000335
C(17)=0.000492
C(18)=-0.000180
C(19)=-0.000454
```

$N=2\times10^7$结果

```c
C(1)=0.000064
C(2)=-0.000184
C(3)=0.000232
C(4)=0.000205
C(5)=0.000057
C(6)=-0.000043
C(7)=-0.000112
C(8)=0.000167
C(9)=0.000084
C(10)=-0.000361
C(11)=-0.000438
C(12)=-0.000019
C(13)=-0.000065
C(14)=0.000070
C(15)=0.000072
C(16)=0.000129
C(17)=0.000088
C(18)=-0.000123
C(19)=0.000115
```

为进一步研究$C(l)$的特性，我们可以将$l$取的比较大，做出$C(l)$分布情况图（在此处我们生成了300个数据）：

<img src="E:\Computational_Physics\hw1\C_l.png" alt="C_l" style="zoom:80%;" />

由以上结果我们可以看出，当N比较大时($N\ge10^7$)，相关系数很小，基本上集中在$10^{-3}-10^{-4}$数量级，这与$\frac {1} {\sqrt{N}}$的数量级基本一致。

随着参数$l$的变化，自相关系数$C(l)$时大时小，没有什么明显规律，说明只看二维关联不足以衡量随机数质量。



## 4.总结

1.16807生成器产生的随机数质量不错，分布比较均匀，随机独立性比较好。

2.只看二维关联函数并不能完全评价随机数质量，衡量一组随机数的质量应该从多方面考虑。

