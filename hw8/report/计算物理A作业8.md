<h1 align = 'center'>计算物理A作业8</h1>

<h3 align = 'center'>吕遨 PB19030789</h3>

## 1.作业题目

用Monte Carlo方法计算如下定积分，并讨论有效数字位数。

（1）$\int_0^5\sqrt{x+2\sqrt{x}}\,\text d x$

（2）$\int^{\frac{7}{10}}_0\,\text dx\int^{\frac{4}{7}}_0\,\text dy\int^{\frac{9}{10}}_0\,\text dz\int^{2}_0\,\text du\int^{\frac{13}{11}}_0\,\text dv(5-x^2+y^2-z^2+u^3-v^3)$



## 2.算法和主要公式

### 2.1 Monte Carlo平均值法计算定积分

根据微积分中的平均值定理
$$
\int^b_af(x)\,\text dx=(b-a)\left<f\right>
$$
平均值
$$
\left<f\right>=\frac1 N\sum^N_{i=1}f(x_i)
$$
故有
$$
\int^b_af(x)\,\text dx=\frac{(b-a)} N\sum^N_{i=1}f(x_i)
$$
其中$x_i$为区间$[a,b]$上的均匀随机数。

这种方法也可以推广到高维的多变量积分：
$$
\int_{a_1}^{b_1}\text dx_1\int_{a_2}^{b_2}\text dx_2\cdots\int_{a_n}^{b_n}\text dx_nf(x_1,x_2,\cdots,x_n)=\frac1 N\left[\prod_{j=1}^N(b_j-a_j)\right]\sum^N_{i=1}f(x_1,x_2,\cdots,x_n)
$$

### 2.2 大数定律与中心极限定理

大数定律指出，如随机量序列$\{f_i\}$有期待值$\mu$存在，则
$$
\lim_{N\to\infin}\frac1 N\sum_{i=1}^Nf_i\to\mu
$$
中心极限定理指出当$N$为有限值时，有
$$
P\left\{\left|\frac{\left<f\right>-\mu}{\sigma_f/\sqrt{N}}\right|<\beta\right\}\to\Phi(\beta)
$$
其中$\Phi(\beta)$是Gauss正态分布。函数标准差$\sigma_f=\sqrt{\left<f^2\right>-\left<f\right>^2}$

积分值的标准差$\sigma_s=(b-a)\frac{\sigma_f}{\sqrt{N}}$

上式表明$\sigma_s$随着$\frac 1 {\sqrt{N}}$变化，要达到一定的计算精度，必须以平方的方式增加总样本点数。

### 2.3 算法和程序说明

程序的基本流程如下：

<div align='center'>
    <img src="process.png" style="zoom:120%;">
</div>

在**mc_integral_1.c**中计算第一个单变量积分，在**mc_integral_2.c**中计算第二个多变量积分。



## 3.计算结果及分析

### 3.1 单变量积分结果

用Mathematica软件计算得到该定积分的准确值（15位有效数字）$I_1=11.3179614888953$，程序计算结果如下：

|   N    | Integral Value |      Error      | $\frac 1 {\sqrt{N}}$ |
| :----: | :------------: | :-------------: | :------------------: |
|  $10$  |  10.16842331   | 1.14953818e+000 |   3.16227766e-001    |
| $10^2$ |  11.45425541   | 1.36293926e-001 |   1.00000000e-001    |
| $10^3$ |  11.31009229   | 7.86920035e-003 |   3.16227766e-002    |
| $10^4$ |  11.31283693   | 5.12456222e-003 |   1.00000000e-002    |
| $10^5$ |  11.32084023   | 2.87873845e-003 |   3.16227766e-003    |
| $10^6$ |  11.31835098   | 3.89493418e-004 |   1.00000000e-003    |
| $10^7$ |  11.31861197   | 6.50479908e-004 |   3.16227766e-004    |
| $10^8$ |  11.31827696   | 3.15475112e-004 |   1.00000000e-004    |

由上可见，随着$N$的增大，积分误差逐渐接近$\frac 1 {\sqrt{N}}$。整体来看当$N$增加100倍时误差缩小大约10倍，这符合Monte Carlo方法的预期。

### 3.2 多变量积分结果

用Mathematica软件计算得到该定积分的准确值（15位有效数字）$I_2=5.32911646773318$，程序计算结果如下：

|   N    | Integral Value |      Error      | $\frac 1 {\sqrt{N}}$ |
| :----: | :------------: | :-------------: | :------------------: |
|  $10$  |   5.46631314   | 1.37196669e-001 |   3.16227766e-001    |
| $10^2$ |   5.32121474   | 7.90172418e-003 |   1.00000000e-001    |
| $10^3$ |   5.27780425   | 5.13122140e-002 |   3.16227766e-002    |
| $10^4$ |   5.40143201   | 7.23155462e-002 |   1.00000000e-002    |
| $10^5$ |   5.33272249   | 3.60602410e-003 |   3.16227766e-003    |
| $10^6$ |   5.33170736   | 2.59088757e-003 |   1.00000000e-003    |
| $10^7$ |   5.32904296   | 7.35120956e-005 |   3.16227766e-004    |

上述结果与3.1中结果类似，随着$N$的增大，积分误差逐渐接近$\frac 1 {\sqrt{N}}$。



## 4.总结

（1）用Monte Carlo方法计算定积分时，点数$N$较大时结果比较准确。

（2）误差量级就是计算值的无效位数，当取点数增大时误差将减小，有效数字的位数会增加。

（3）如果想提高计算精度，就需要显著增加取点数$N$,这必然会导致效率的降低。